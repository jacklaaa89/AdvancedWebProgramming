<!DOCTYPE html>
<!--
TODO - Add bootstrap and javascript files.
-->
<html>
    <head>
        <meta charset="UTF-8">
        <title>Authorize</title>
    </head>
    <body id="body">
        <?php foreach($request->getScope() as $scope) { ?>
        <ul>
            <input type="checkbox" data-key="<?php echo strtolower($scope); ?>"
                   data-checked="1" checked="checked" class="permission"/> <?php echo $scope; ?>
        </ul>
        <?php } ?>
        <button class="button" data-auth="accept">Accept</button>
        <button class="button" data-auth="decline">Decline</button>
        <script type="text/javascript">
            $(document).ready(function(){
                $('.button').click(function(){
                    var checked = [];
                    $('.permission').each(function(){
                        checked[$(this).data('key')] = $(this).data('checked');
                    });
                    $.ajax({
                        'url' : '/oauth/background/authorize/'+'<?php echo $request->getRequestID(); ?>',
                        'dataType' : 'JSON',
                        'data' : {
                            'auth' : $(this).data('auth'),
                            'userID' : '<?php echo $userID; ?>',
                            'checked' : JSON.stringify(checked)
                        },
                        'type' : 'POST',
                        'error' : function() {
                            alert('An error occured');
                        },
                        'done' : function(response) {
                            window.location = response.url;
                        }
                    });
                });
                $('.permission').change(function() {
                    $(this).data('checked', ($(this).data('checked') === '1') ? '0' : '1');
                });
            });
        </script>
    </body>
</html>
